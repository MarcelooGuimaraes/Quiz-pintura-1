<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Renova DF ‚Äî Pintura | Apostila + Quiz Bil√≠ngue com √Åudio</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  :root{
    /* Identidade Renova */
    --brand-blue: #0b5394;
    --brand-green: #22b14c;

    /* Tema */
    --bg-light: #f0f4f8;
    --bg-dark: #111827;
    --ink-light: #111827;
    --ink-dark: #f9fafb;

    /* Componentes */
    --shadow: 0 6px 18px rgba(0,0,0,.18);
    --radius: 12px;
    --transition: .25s ease;

    /* Tokens existentes */
    --bg: linear-gradient(180deg, #e3f2fd, #fdfdfd);
    --card: #ffffff;
    --ink: #111827;
    --muted: #6b7280;
    --ok: #16a34a;
    --bad: #dc2626;
    --warn: #d97706;
    --fontScale: 1;
  }
  body.dark{
    --bg: linear-gradient(180deg, #0f172a, #1e293b);
    --card: #1e293b;
    --ink: #f3f4f6;
    --muted: #9ca3af;
    --shadow: 0 6px 20px rgba(0,0,0,.5);
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }
  html, body { height: 100%; }
  body{
    font-family: Inter, system-ui, sans-serif;
    color: var(--ink);
    background: var(--bg);
    line-height: 1.6;
    font-size: calc(16px * var(--fontScale));
    transition: background var(--transition), color var(--transition);
  }

  /* ===== CABE√áALHO (IDENTIDADE RENOVA) ===== */
  header.renova-header{
    position: sticky; top: 0; z-index: 100;
    background: linear-gradient(135deg, var(--brand-blue), var(--brand-green));
    color: #fff;
    border-bottom: 3px solid var(--brand-green);
    box-shadow: var(--shadow);
  }
  .renova-header .bar{
    max-width: 1100px;
    margin: 0 auto;
    padding: 12px 20px;
    display: grid;
    grid-template-columns: 1fr auto;
    align-items: center;
    gap: 14px;
  }

  /* Marca e t√≠tulo */
  .rh-title{
    display:flex; align-items:center; gap:14px; min-width:0;
  }
  .rh-logo{
    height: 50px; width:auto; border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,.25);
    background: #fff; object-fit:cover;
  }
  .rh-text{min-width:0}
  .rh-text h1{
    margin:0; font-size: clamp(18px, 3.5vw, 28px); line-height:1.1; font-weight:800;
    text-shadow: 0 1px 0 rgba(0,0,0,.2);
  }
  .rh-sub{
    display:block; margin-top:2px; font-weight:600; opacity:.95; font-size:.92rem;
    color: #e7fff0;
  }

  /* Controles √† direita */
  .rh-controls{
    display:flex; flex-wrap:wrap; align-items:center; justify-content:flex-end; gap:10px;
  }
  .btn, select.lang{
    appearance:none; border:none; outline:none; cursor:pointer;
    font-weight:700; border-radius: 12px; padding:10px 14px;
    background: #f9fafb; color:#111; transition: transform var(--transition), background var(--transition), box-shadow var(--transition);
  }
  .btn:hover, select.lang:hover{ transform: translateY(-1px); background:#e0f2fe; box-shadow: 0 6px 18px rgba(0,0,0,.18); }
  body.dark .btn, body.dark select.lang{ background:#374151; color:#fff; }
  body.dark .btn:hover, body.dark select.lang:hover{ background:#4b5563; }
  .btn.primary{
    background: linear-gradient(135deg, var(--brand-blue), var(--brand-green));
    color:#fff;
  }

  /* ===== LAYOUT E COMPONENTES ===== */
  .wrap{ max-width: 1000px; margin:0 auto; padding: 22px 18px; }
  .card{ background: var(--card); border:1px solid #e5e7eb; border-radius: var(--radius); box-shadow: var(--shadow); padding: 20px; margin-bottom:22px; transition: transform var(--transition), background var(--transition); }
  body.dark .card{ border-color:#475569; }
  .card:hover{ transform: translateY(-2px); }
  .section-title{ font-size: clamp(16px, 2.4vw, 22px); margin-bottom: 12px; color: var(--brand-blue); font-weight:700; }
  .question{ font-weight:700; margin-bottom: 12px; font-size: 1.05em; }
  .options{ display:grid; gap:12px; }
  .option{ display:flex; align-items:center; gap:10px; padding: 12px; border:1px solid #e5e7eb; border-radius: 10px; cursor:pointer; background:#f9fafb; transition: background var(--transition), transform var(--transition); }
  body.dark .option{ background:#334155; border-color:#475569; }
  .option:hover{ background:#e0f2fe; transform: translateX(3px); }
  body.dark .option:hover{ background:#475569; }
  .option input{ width:18px; height:18px; accent-color: var(--brand-blue); }
  /* Correct/incorrect ONLY after finalize */
  .option.correct{ border-color: var(--ok); background:#ecfdf5; }
  body.dark .option.correct{ background:#14532d22; }
  .option.incorrect{ border-color: var(--bad); background:#fef2f2; }
  body.dark .option.incorrect{ background:#7f1d1d22; }
  .speak, .hint-btn{ margin-left:auto; background:none; border:none; cursor:pointer; font-size:20px; color: var(--brand-blue); transition: transform var(--transition); }
  .speak:hover, .hint-btn:hover { transform: scale(1.15); }
  .hint-text{ display:none; margin-top:10px; padding:12px; background:#f0f9ff; border-left:4px solid var(--brand-blue); border-radius:8px; font-size:.95em; color: var(--muted); }
  body.dark .hint-text{ background:#334155; color:#d1d5db; }
  .hint-text.show{ display:block; }
  .small{ font-size:.92em; color:var(--muted); }

  /* Gate */
  .gate-head{display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap}
  .pill{display:inline-block; padding:6px 10px; border-radius:999px; background:#eef2ff; color:#1e3a8a; border:1px solid #c7d2fe; font-size:.8rem}
  .gate-box{ max-height: 52vh; overflow:auto; border:1px dashed #cbd5e1; border-radius:12px; padding:14px; background:#f9fafb; }
  body.dark .gate-box{ background:#334155; border-color:#475569; }
  .gate-actions{ display:flex; align-items:center; gap:10px; flex-wrap:wrap; }

  /* Timer badge */
  .timer{ display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px; background:#f1f5f9; border:1px solid #e2e8f0; font-weight:700; }
  body.dark .timer{ background:#334155; border-color:#475569; color:#f3f4f6; }

  /* Print header */
  #printHeader{ display:none; }
  #printHeader h2{ margin-bottom:6px; }
  #printHeader .grid{ display:grid; grid-template-columns: 1fr 1fr; gap:8px; }
  #printHeader .row{ padding:6px 10px; border:1px solid #e5e7eb; border-radius:8px; background:#f8fafc; }
  @media print{
    header, .controls, .scroll-top, #gateCard .gate-actions, #gateCard .pill, #actionsCard { display:none !important; }
    #printHeader{ display:block !important; margin-bottom:16px; }
    .card{ box-shadow:none; border-color:#e5e7eb; }
    body{ background:white; }
  }
  @media (max-width:720px){
    .renova-header .bar{ grid-template-columns: 1fr; gap: 10px; }
    .rh-controls{ justify-content:flex-start; }
  }

  /* Scroll top */
  .scroll-top{ position:fixed; bottom:20px; right:20px; background:var(--brand-blue); color:white; border:none; padding:14px; border-radius:50%; cursor:pointer; box-shadow: var(--shadow); font-size:20px; display:none; transition: transform var(--transition), background var(--transition); }
  .scroll-top:hover{ background: var(--brand-green); transform: translateY(-3px); }

  /* Success banner */
  .success-banner{
    border-left: 4px solid var(--ok);
    background: #ecfdf5;
  }
  body.dark .success-banner{ background: #14532d22; }

  /* ===== Modal "Parab√©ns" ===== */
  .modal-overlay{
    position:fixed; inset:0; background:rgba(0,0,0,.6);
    display:none; align-items:center; justify-content:center;
    z-index:1000; padding:20px;
  }
  .modal{
    width:min(560px, 92vw);
    background: linear-gradient(135deg, #ffffff, #f6fff9);
    border-radius: 16px; box-shadow: var(--shadow);
    border: 2px solid var(--brand-green);
    overflow:hidden;
  }
  body.dark .modal{
    background: linear-gradient(135deg, #0f172a, #0b1b12);
    border-color: #34d399;
  }
  .modal-head{
    padding:18px 20px; color:#fff;
    background: linear-gradient(135deg, var(--brand-blue), var(--brand-green));
    display:flex; align-items:center; gap:12px; font-weight:800;
  }
  .modal-body{ padding:18px 20px; line-height:1.6; }
  .modal-actions{
    padding:16px 20px; display:flex; gap:10px; justify-content:flex-end; background: rgba(0,0,0,.02);
  }
  .btn-outline, .btn-solid{
    appearance:none; border:none; cursor:pointer; padding:10px 14px; border-radius:12px; font-weight:700;
  }
  .btn-outline{ background:#fff; border:2px solid var(--brand-green); color:#065f46; }
  .btn-solid{ background: linear-gradient(135deg, var(--brand-blue), var(--brand-green)); color:#fff; }
  body.dark .btn-outline{ background:#111827; color:#d1fae5; border-color:#10b981; }

  /* Confete simples */
  .confetti{ position:absolute; inset:0; pointer-events:none; overflow:hidden; }
  .confetti i{ position:absolute; top:-10px; font-style:normal; animation:drop 2.6s linear forwards; }
  @keyframes drop{ to{ transform: translateY(110vh) rotate(360deg); opacity:.9; } }

  /* ===== Rodap√© assinatura ===== */
  .renova-footer{
    max-width:1100px; margin:24px auto 40px; padding:14px 20px;
    background: rgba(255,255,255,.85);
    border: 1px solid rgba(0,0,0,.06);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    font-size:.95rem; text-align:center;
  }
  body.dark .renova-footer{
    background: rgba(17,24,39,.6); border-color: rgba(255,255,255,.1);
  }
</style>
</head>
<body>

<!-- ===== CABE√áALHO NO ESTILO RENOVA ===== -->
<header class="renova-header" role="banner">
  <div class="bar">
    <!-- Marca / T√≠tulo -->
    <div class="rh-title">
      <img class="rh-logo" src="https://opiniaobrasilia.com.br/wp-content/uploads/2020/12/RenovaDF.jpeg" alt="Logo Renova DF">
      <div class="rh-text">
        <h1 id="mainTitle">No√ß√µes de Pintura ‚Äî Apostila + Quiz</h1>
        <small class="rh-sub" id="subtitle">(Leia a apostila para liberar o quiz)</small>
      </div>
    </div>

    <!-- Controles -->
    <div class="rh-controls">
      <select class="lang" id="lang" aria-label="Idioma">
        <option value="pt" selected>üáßüá∑ Portugu√™s</option>
        <option value="en">üá∫üá∏ English</option>
        <option value="es">üá™üá∏ Espa√±ol</option>
      </select>

      <button class="btn" id="playApostila">üîä Ler s√≥ a apostila</button>
      <button class="btn primary" id="playAll" disabled>üîä Ler tudo</button>
      <button class="btn" id="stopVoice">‚èπÔ∏è Parar</button>

      <button class="btn" id="fontPlus">A+</button>
      <button class="btn" id="fontMinus">A-</button>

      <button class="btn" id="toggleDark" title="Modo escuro">üåô Dark</button>
    </div>
  </div>
</header>

<main class="wrap" id="app">
  <!-- Cabe√ßalho impresso -->
  <section id="printHeader" class="card">
    <h2 id="printTitle">Renova DF ‚Äî Gabarito</h2>
    <div class="grid">
      <div class="row"><strong id="phAlunoLbl">Aluno(a):</strong> <span id="phAluno">‚Äî</span></div>
      <div class="row"><strong id="phPeriodoLbl">Per√≠odo:</strong> <span id="phPeriodo">‚Äî</span></div>
      <div class="row"><strong id="phDataLbl">Data:</strong> <span id="phData">‚Äî</span></div>
      <div class="row"><strong id="phTempoLbl">Tempo:</strong> <span id="phTempo">‚Äî</span></div>
      <div class="row"><strong id="phNotaLbl">Pontua√ß√£o:</strong> <span id="phNota">‚Äî</span></div>
    </div>
  </section>

  <!-- Gate / Apostila -->
  <section class="card" id="gateCard">
    <div class="gate-head">
      <h2 class="section-title" id="gateTitle">Apostila resumida (leitura obrigat√≥ria)</h2>
      <span class="pill" id="gateStatus">Leitura pendente</span>
    </div>
    <div class="gate-box" id="gateBox" aria-label="conte√∫do da apostila (rolagem obrigat√≥ria)"></div>
    <div class="gate-actions" style="margin-top:12px">
      <label style="display:flex; align-items:center; gap:8px;">
        <input type="checkbox" id="readConfirm" disabled />
        <span id="readConfirmLabel"><strong>Li a apostila e estou pronto(a) para iniciar o quiz.</strong></span>
      </label>
      <button class="btn primary" id="startQuiz" disabled>Come√ßar o quiz</button>
      <button class="btn" id="printApostila">üñ®Ô∏è Imprimir/Salvar PDF</button>
      <span class="small" id="scrollHint">Role at√© o fim para habilitar a confirma√ß√£o.</span>
    </div>
  </section>

  <!-- Pontua√ß√£o + Timer -->
  <section class="card" id="scoreCard" style="display:none">
    <div style="display:flex; align-items:center; gap:12px; justify-content:space-between">
      <div>
        <h2 class="section-title" id="scoreTitle">Pontua√ß√£o</h2>
        <p class="score"><span id="scoreText">‚Äî</span>/<span id="scoreTotal">0</span></p>
      </div>
      <div class="timer" aria-live="polite" id="timerWrap">
        ‚è±Ô∏è <span id="timerLabel">Tempo</span>:
        <span id="timer">00:00</span>
      </div>
    </div>
  </section>

  <!-- Banner: visto registrado -->
  <section class="card success-banner" id="seenBanner" style="display:none">
    <h3 id="seenTitle" style="margin-bottom:6px">Registro confirmado</h3>
    <p id="seenBody" class="small">Sua nota foi X/Y e o visto foi registrado em DD/MM/AAAA HH:mm.</p>
  </section>

  <!-- Identifica√ß√£o -->
  <section class="card" id="identCard" style="display:none">
    <h2 class="section-title" id="identTitle">Identifica√ß√£o</h2>
    <div style="display:grid; gap:12px; grid-template-columns:1fr 1fr">
      <div>
        <label for="aluno" style="font-weight:600" id="labelAluno">Nome completo</label>
        <input id="aluno" class="btn" style="width:100%; text-align:left" placeholder="Ex.: Ana Beatriz Silva" autocomplete="name" />
      </div>
      <div>
        <label for="periodo" style="font-weight:600" id="labelPeriodo">Per√≠odo da turma</label>
        <select id="periodo" class="btn" style="width:100%; text-align:left">
          <option value="" id="optSelecione">Selecione‚Ä¶</option>
          <option id="optManha">Manh√£</option>
          <option id="optTarde">Tarde</option>
          <option id="optNoite">Noite</option>
          <option id="optIntegral">Integral</option>
        </select>
      </div>
    </div>
  </section>

  <!-- Instru√ß√µes (ANTES do quiz) -->
  <section class="card" id="instCard" style="display:none">
    <h2 class="section-title" id="instTitle">Instru√ß√µes</h2>
    <div id="instText"></div>
  </section>

  <!-- Quiz -->
  <div id="sections" style="display:none"></div>

  <!-- A√ß√µes (AP√ìS a √∫ltima pergunta) -->
  <section class="card" id="actionsCard" style="display:none">
    <div style="display:flex; flex-wrap:wrap; gap:10px">
      <button class="btn good" id="finalizeQuiz">‚úÖ Finalizar</button>
      <button class="btn" id="showKey">üìò Gabarito</button>
      <button class="btn good" id="markSeen" disabled>‚úîÔ∏è Receber visto & enviar</button>
      <button class="btn warn" id="resetQuiz">‚Ü©Ô∏è Reiniciar</button>
    </div>
    <p class="small" style="margin-top:8px" id="afterTip"></p>
  </section>
</main>

<!-- Rodap√© com assinatura -->
<footer class="renova-footer">
  Criado por <strong>Marcelo Emanoel</strong>.
</footer>

<!-- Bot√£o scroll top -->
<button class="scroll-top" id="scrollTop">‚¨ÜÔ∏è</button>

<!-- ===== Modal Parab√©ns ===== -->
<div class="modal-overlay" id="modalVisto" role="dialog" aria-modal="true" aria-labelledby="modalVistoTitle" aria-hidden="true">
  <div class="modal">
    <div class="modal-head">
      <span style="font-size:1.4rem">üéâ</span>
      <div id="modalVistoTitle">Parab√©ns! Voc√™ conquistou o visto ‚úÖ</div>
    </div>
    <div class="modal-body">
      <p><strong>Excelente!</strong> Vamos registrar seu resultado.</p>
      <p class="small" id="vistoStatus" style="margin-top:6px; opacity:.9">Enviando‚Ä¶</p>
      <div class="confetti" id="confettiBox" aria-hidden="true"></div>
    </div>
    <div class="modal-actions">
      <button class="btn-outline" id="btnVistoFechar">Fechar</button>
      <button class="btn-solid" id="btnVistoOk">Ok, entendi</button>
    </div>
  </div>
</div>

<script>
/* ====== CONFIG: endpoint da sua planilha ====== */
const SHEETS_ENDPOINT = 'https://script.google.com/macros/s/AKfycbwNbRfo_oobl__FIQ78mWK67Ln7v7gQYMbhN-xTgau9sNX_WEOm3_Lq83FcMDvxiiuLdg/exec';
</script>

<script>
/* =========================
   I18N (PT / EN / ES)
   ========================= */
const I18N = {
  pt: {
    htmlLang: 'pt-BR',
    docTitle: 'Renova DF ‚Äî Pintura | Apostila + Quiz Bil√≠ngue com √Åudio',
    headerTitle: 'No√ß√µes de Pintura ‚Äî Apostila + Quiz',
    headerSubtitle: '(Leia a apostila para liberar o quiz)',
    gateTitle: 'Apostila resumida (leitura obrigat√≥ria)',
    gateStatusPending: 'Leitura pendente',
    gateStatusDone: 'Leitura confirmada',
    readConfirmLabel: 'Li a apostila e estou pronto(a) para iniciar o quiz.',
    startQuiz: 'Come√ßar o quiz',
    printApostila: 'üñ®Ô∏è Imprimir/Salvar PDF',
    scrollHint: 'Role at√© o fim para habilitar a confirma√ß√£o.',
    playApostila: 'üîä Ler s√≥ a apostila',
    playAll: 'üîä Ler tudo',
    stop: '‚èπÔ∏è Parar',
    dark: 'üåô Dark',
    instructions: 'Instru√ß√µes',
    instText: `
      <ol style="padding-left:18px; margin-top:6px">
        <li>Leia a apostila acima at√© o final. Marque a caixa ‚ÄúLi a apostila‚Äù.</li>
        <li>Clique em <strong>Come√ßar o quiz</strong> para liberar as quest√µes e iniciar o cron√¥metro.</li>
        <li>Em cada quest√£o, toque <strong>üîà</strong> para ouvir a leitura e <strong>üí°</strong> para ver/escutar uma dica.</li>
        <li>Ao terminar, clique em <strong>‚úÖ Finalizar</strong> (no fim da p√°gina) para corrigir, calcular a nota e parar o tempo.</li>
        <li>Preencha seu <strong>nome</strong> e <strong>per√≠odo</strong>. Clique em <strong>‚úîÔ∏è Receber visto & enviar</strong> para registrar na planilha.</li>
      </ol>
    `,
    keyBtn: 'üìò Gabarito',
    resetBtn: '‚Ü©Ô∏è Reiniciar',
    scoreLabel: 'Pontua√ß√£o',
    timerLabel: 'Tempo',
    finalizeBtn: '‚úÖ Finalizar',
    markSeenBtn: '‚úîÔ∏è Receber visto & enviar',
    markSeenDone: '‚úîÔ∏è Visto registrado',
    seenTitle: 'Registro confirmado',
    seenBody: (nota, datahora) => `Sua nota foi <strong>${nota}</strong> e o visto foi registrado em <strong>${datahora}</strong>.`,
    alerts: {
      fillNamePeriod: 'Preencha nome e per√≠odo antes de enviar.',
      sendSuccess: 'Visto registrado e resultado enviado para a planilha!',
      sendFail: 'N√£o foi poss√≠vel enviar agora. Verifique a internet/endpoint.',
      answerAll: 'Responda todas as quest√µes antes de finalizar.',
      keyAfterFinish: 'O gabarito s√≥ pode ser exibido ap√≥s finalizar o quiz.'
    },
    printTitle: 'Renova DF ‚Äî Gabarito',
    phAlunoLbl: 'Aluno(a):',
    phPeriodoLbl: 'Per√≠odo:',
    phDataLbl: 'Data:',
    phTempoLbl: 'Tempo:',
    phNotaLbl: 'Pontua√ß√£o:',
    identTitle: 'Identifica√ß√£o',
    labelAluno: 'Nome completo',
    labelPeriodo: 'Per√≠odo da turma',
    optSelecione: 'Selecione‚Ä¶',
    optManha: 'Manh√£',
    optTarde: 'Tarde',
    optNoite: 'Noite',
    optIntegral: 'Integral',
    sayIcon: 'üîà',
    hintIcon: 'üí°',
    voice: 'pt-BR',
    afterTip: 'Dica: ap√≥s finalizar, confira a pontua√ß√£o acima e, se j√° preencheu nome e per√≠odo, clique em ‚ÄúReceber visto & enviar‚Äù.',
    apostilaHTML: `
      <p><strong>Pintar n√£o √© apenas aplicar tinta</strong>: √© preparar a superf√≠cie, proteger o ambiente, escolher o produto certo, <strong>diluir corretamente</strong> e trabalhar com seguran√ßa.</p>
      <h3>üîí Seguran√ßa (EPIs)</h3>
      <p>EPIs essenciais: <strong>√≥culos de prote√ß√£o</strong>, <strong>respirador/m√°scara</strong> e <strong>luvas</strong>. Conforme o servi√ßo: botas, protetor auricular e capacete.</p>
      <h3>üõ†Ô∏è Materiais e Ferramentas</h3>
      <p>Kit completo: lixas, esp√°tulas, desempenadeira, rolos, trinchas, fita/lona, selador/primer, massa, <strong>tinta</strong>, <strong>diluente</strong> e EPIs. A massa corrida aplica-se com <strong>esp√°tula e desempenadeira</strong>.</p>
      <h3>üìë Etapas da Pintura</h3>
      <ol>
        <li>Proteger o ambiente;</li><li>Corrigir/alisar;</li><li>Lixar e limpar;</li>
        <li>Aplicar selador/fundo;</li><li>Passar massa (se necess√°rio) e lixar/limpar novamente;</li>
        <li>Aplicar as dem√£os de acabamento.</li>
      </ol>
      <h3>üé® Tipos de tinta</h3>
      <ul>
        <li><strong>PVA (l√°tex, √°gua):</strong> interiores de alvenaria; baixo odor; geralmente fosca.</li>
        <li><strong>Acr√≠lica:</strong> mais resistente √† umidade e lav√°vel; interna/externa; fosco/acetinado/semibrilho.</li>
        <li><strong>Esmalte sint√©tico (solvente):</strong> madeira e metais; usar seladora (madeira) e fundo anticorrosivo/zarc√£o (metal).</li>
        <li><strong>Ep√≥xi:</strong> alta resist√™ncia; comum em pisos, azulejos e metais; muitas vezes bicomponente (A+B).</li>
        <li><strong>PU:</strong> muito resistente; uso espec√≠fico.</li>
      </ul>
      <h3>üíß Dilui√ß√£o ‚Äî Guia r√°pido</h3>
      <p>A <strong>dilui√ß√£o</strong> ajusta a viscosidade, melhora o rendimento e a aplica√ß√£o, <em>evitando marcas e bolhas</em>. Siga <u>sempre</u> o r√≥tulo do fabricante.</p>
      <table style="width:100%; border-collapse:collapse; font-size:.95em"><thead><tr>
        <th style="border:1px solid #e5e7eb; padding:8px; text-align:left">Tipo</th>
        <th style="border:1px solid #e5e7eb; padding:8px; text-align:left">Diluente</th>
        <th style="border:1px solid #e5e7eb; padding:8px; text-align:left">% (geral)</th>
        <th style="border:1px solid #e5e7eb; padding:8px; text-align:left">Observa√ß√µes</th>
      </tr></thead><tbody>
        <tr><td style="border:1px solid #e5e7eb; padding:8px">PVA (l√°tex/√°gua)</td><td style="border:1px solid #e5e7eb; padding:8px">√Ågua limpa</td><td style="border:1px solid #e5e7eb; padding:8px">10‚Äì20%</td><td style="border:1px solid #e5e7eb; padding:8px">Agitar bem. Ajustar pela ferramenta.</td></tr>
        <tr><td style="border:1px solid #e5e7eb; padding:8px">Acr√≠lica</td><td style="border:1px solid #e5e7eb; padding:8px">√Ågua limpa</td><td style="border:1px solid #e5e7eb; padding:8px">10‚Äì20%</td><td style="border:1px solid #e5e7eb; padding:8px">Mais resistente √† umidade.</td></tr>
        <tr><td style="border:1px solid #e5e7eb; padding:8px">Esmalte sint√©tico</td><td style="border:1px solid #e5e7eb; padding:8px">Aguarr√°s</td><td style="border:1px solid #e5e7eb; padding:8px">5‚Äì15%</td><td style="border:1px solid #e5e7eb; padding:8px"><strong>Nunca</strong> usar √°gua.</td></tr>
        <tr><td style="border:1px solid #e5e7eb; padding:8px">Ep√≥xi (2 comp.)</td><td style="border:1px solid #e5e7eb; padding:8px">Mistura A+B</td><td style="border:1px solid #e5e7eb; padding:8px">Conforme r√≥tulo</td><td style="border:1px solid #e5e7eb; padding:8px">Respeitar <em>pot life</em>.</td></tr>
        <tr><td style="border:1px solid #e5e7eb; padding:8px">PU</td><td style="border:1px solid #e5e7eb; padding:8px">Solvente indicado</td><td style="border:1px solid #e5e7eb; padding:8px">Conforme r√≥tulo</td><td style="border:1px solid #e5e7eb; padding:8px">Aplica√ß√µes espec√≠ficas.</td></tr>
      </tbody></table>
      <p style="margin-top:8px"><strong>Dica:</strong> para pistola/compressor, a tinta costuma precisar de <em>maior</em> dilui√ß√£o que no rolo/pincel.</p>
      <h3>üåà Cores</h3>
      <p><strong>Prim√°rias (pigmento):</strong> vermelho, amarelo e azul. <strong>Secund√°rias:</strong> laranja, verde, violeta. <strong>Terci√°rias:</strong> prim√°ria + secund√°ria adjacente (ex.: azul-esverdeado).</p>
      <h3>‚öôÔ∏è T√©cnicas e Equipamentos</h3>
      <ul>
        <li>Compressor + pistola ‚Üí acabamento uniforme e r√°pido (usar respirador e ventila√ß√£o).</li>
        <li>Equipamentos <strong>airless</strong>: pulveriza√ß√£o por alta press√£o sem ar.</li>
        <li><strong>Rendimento</strong>: m¬≤ por litro por dem√£o ‚Äî use a embalagem para calcular a quantidade.</li>
      </ul>
    `,
    data: [
      { t:"1) A tinta ep√≥xi √© mais indicada para:", a:["Paredes internas secas com baixo tr√°fego","√Åreas que precisam de alta resist√™ncia e f√°cil limpeza (pisos, azulejos, metais preparados)","Tetos de salas e quartos","Texturas decorativas externas"], c:1, hint:"Ep√≥xi = alta resist√™ncia mec√¢nica/qu√≠mica; comum em pisos, azulejos e metais preparados." },
      { t:"2) Quais EPIs s√£o essenciais na pintura?", a:["√ìculos, respirador/m√°scara e luvas","Bon√© e avental","Apenas protetor auricular","Somente botas"], c:0, hint:"√ìculos + respirador/m√°scara + luvas formam o trio b√°sico de seguran√ßa." },
      { t:"3) Para aplicar massa corrida usamos, principalmente:", a:["Rolo de l√£ e pincel largo","Esp√°tula e desempenadeira","Broxa e pistola","Trincha e compressor"], c:1, hint:"Esp√°tula e desempenadeira espalham e nivelam a massa." },
      { t:"4) Conjunto mais completo para executar pintura:", a:["Rolo, tinta e lixa","Lixas, esp√°tulas, rolos, trinchas, fita/lona, selador/primer, massa, tinta, diluente e EPIs","Apenas pistola e compressor","Somente tinta l√°tex"], c:1, hint:"Organize por etapas: preparar, proteger e pintar." },
      { t:"5) Ordem correta das etapas (pintura interna):", a:["Pintar ‚Üí lixar ‚Üí proteger ambiente","Proteger ‚Üí corrigir/alisar ‚Üí lixar/limpar ‚Üí selador ‚Üí massa ‚Üí lixar/limpar ‚Üí dem√£os de acabamento","Aplicar acabamento direto","Selador por √∫ltimo"], c:1, hint:"Prepara√ß√£o e limpeza entre etapas evitam marcas e falhas." },
      { t:"6) Tipos de tinta na constru√ß√£o civil:", a:["PVA, acr√≠lica, esmalte sint√©tico, ep√≥xi, PU","Guache e aquarela","Tinta t√©rmica de motor","Somente √≥leo"], c:0, hint:"A escolha depende do substrato e do uso (interno/externo)." },
      { t:"7) L√°tex PVA √©:", a:["√Ä base de solvente","√Ä base de √°gua, comum em interiores de alvenaria","Espec√≠fica para pisos industriais","Somente fachadas"], c:1, hint:"Econ√¥mica, baixo odor; geralmente fosca para interiores secos." },
      { t:"8) Sobre tinta ep√≥xi, √© correto afirmar:", a:["√â sempre monocomponente","Pode ser bicomponente (A+B) e tem alta resist√™ncia","Indicada s√≥ para tetos","N√£o adere a metais"], c:1, hint:"Respeite o pot life ao misturar as partes." },
      { t:"9) A tinta acr√≠lica se destaca por:", a:["Menor resist√™ncia √† umidade que o PVA","Maior resist√™ncia √† umidade e lavabilidade; serve para √°reas internas e externas","Ser usada apenas em madeira","N√£o aceitar diferentes acabamentos"], c:1, hint:"Dispon√≠vel em fosco, acetinado e semibrilho." },
      { t:"10) Esmalte sint√©tico √© recomendado para:", a:["Madeira e metais","Gesso cru","Texturas de parede","Pisos industriais"], c:0, hint:"Use seladora (madeira) e fundo anticorrosivo (metal)." },
      { t:"11) Zarc√£o √©:", a:["Uma tinta √† base de √°gua","Um primer/fundo anticorrosivo para a√ßo","Um tipo de lixa","Aditivo para secagem"], c:1, hint:"Protege o metal contra ferrugem antes do acabamento." },
      { t:"12) Dilui√ß√£o correta do esmalte sint√©tico:", a:["√Ågua","Aguarr√°s (solvente mineral), conforme r√≥tulo","Detergente neutro","Thinner sempre, sem consultar a lata"], c:1, hint:"Tintas base solvente n√£o devem ser dilu√≠das em √°gua." },
      { t:"13) Cores prim√°rias (sistema pigmento):", a:["Ciano, magenta e amarelo","Vermelho, amarelo e azul","Preto, branco e cinza","Verde, laranja e roxo"], c:1, hint:"Neste contexto did√°tico, usamos vermelho, amarelo e azul." },
      { t:"14) ‚ÄúLinhas‚Äù de tintas comuns:", a:["Esmalte sint√©tico, l√°tex PVA, acr√≠lica, ep√≥xi, PU","T√™mpera e guache","Automotiva perolizada apenas","Betume e graxa"], c:0, hint:"Fam√≠lias de produtos por uso/acabamento." },
      { t:"15) Cores secund√°rias s√£o formadas por:", a:["Mistura de duas prim√°rias","Mistura de preto com branco","Prim√°ria com preto","Mistura aleat√≥ria"], c:0, hint:"Laranja, verde e violeta." },
      { t:"16) Exemplo de cor terci√°ria:", a:["Azul puro","Vermelho-arroxeado (prim√°ria + secund√°ria adjacente)","Preto","Branco"], c:1, hint:"Prim√°ria + secund√°ria vizinha." },
      { t:"17) Vantagem do compressor dom√©stico:", a:["Reduz EPIs","Permite pistola (spray) com acabamento uniforme e r√°pido","Dispensa preparo da superf√≠cie","Substitui selador"], c:1, hint:"Produtividade com seguran√ßa respirat√≥ria." },
      { t:"18) ‚ÄúRendimento‚Äù significa:", a:["Tempo de secagem ao toque","√Årea coberta por litro por dem√£o (m¬≤/L/dem√£o)","Quantidade de solvente","Espessura do rolo"], c:1, hint:"Use o rendimento da embalagem para calcular latas." },
      { t:"19) Complete: As cores prim√°rias s√£o consideradas as ________.", a:["secund√°rias","matrizes (cores-m√£e)","past√©is","complementares"], c:1, hint:"Tamb√©m chamadas de cores-m√£e." },
      { t:"20) Complete: S√£o equipamentos com sistema __________, ‚Äúsem ar‚Äù.", a:["HVLP","airless","turbo","centr√≠fugo"], c:1, hint:"Airless = pulveriza√ß√£o por alta press√£o sem mistura de ar." },
    ]
  },

  en: {
    htmlLang: 'en',
    docTitle: 'Renova DF ‚Äî Painting | Handbook + Bilingual Audio Quiz',
    headerTitle: 'Painting Basics ‚Äî Handbook + Quiz',
    headerSubtitle: '(Read the handbook to unlock the quiz)',
    gateTitle: 'Handbook (mandatory reading)',
    gateStatusPending: 'Reading pending',
    gateStatusDone: 'Reading confirmed',
    readConfirmLabel: 'I read the handbook and I am ready to start the quiz.',
    startQuiz: 'Start quiz',
    printApostila: 'üñ®Ô∏è Print/Save PDF',
    scrollHint: 'Scroll to the bottom to enable confirmation.',
    playApostila: 'üîä Read handbook only',
    playAll: 'üîä Read all aloud',
    stop: '‚èπÔ∏è Stop',
    dark: 'üåô Dark',
    instructions: 'Instructions',
    instText: `
      <ol style="padding-left:18px; margin-top:6px">
        <li>Read the handbook above to the end and tick ‚ÄúI read the handbook‚Äù.</li>
        <li>Click <strong>Start quiz</strong> to unlock questions and start the timer.</li>
        <li>On each question, tap <strong>üîà</strong> to listen and <strong>üí°</strong> for a hint.</li>
        <li>When finished, click <strong>‚úÖ Finish</strong> (bottom of the page) to correct, score and stop the timer.</li>
        <li>Fill your <strong>name</strong> and <strong>period</strong>, then press <strong>‚úîÔ∏è Get stamp & send</strong> to register on the sheet.</li>
      </ol>
    `,
    keyBtn: 'üìò Answer key',
    resetBtn: '‚Ü©Ô∏è Reset',
    scoreLabel: 'Score',
    timerLabel: 'Time',
    finalizeBtn: '‚úÖ Finish',
    markSeenBtn: '‚úîÔ∏è Get stamp & send',
    markSeenDone: '‚úîÔ∏è Stamp recorded',
    seenTitle: 'Record confirmed',
    seenBody: (nota, datahora) => `Your score is <strong>${nota}</strong> and the stamp was recorded on <strong>${datahora}</strong>.`,
    alerts: {
      fillNamePeriod: 'Fill in name and period before sending.',
      sendSuccess: 'Stamp recorded and result sent to the sheet!',
      sendFail: 'Could not send now. Check internet/endpoint.',
      answerAll: 'Answer all questions before finishing.',
      keyAfterFinish: 'The answer key can only be shown after finishing the quiz.'
    },
    printTitle: 'Renova DF ‚Äî Answer Key',
    phAlunoLbl: 'Student:',
    phPeriodoLbl: 'Period:',
    phDataLbl: 'Date:',
    phTempoLbl: 'Time:',
    phNotaLbl: 'Score:',
    identTitle: 'Identification',
    labelAluno: 'Full name',
    labelPeriodo: 'Class period',
    optSelecione: 'Select‚Ä¶',
    optManha: 'Morning',
    optTarde: 'Afternoon',
    optNoite: 'Evening',
    optIntegral: 'Full-time',
    sayIcon: 'üîà',
    hintIcon: 'üí°',
    voice: 'en-US',
    afterTip: 'Tip: after finishing, check your score above and, if you have filled in name and period, click ‚ÄúGet stamp & send‚Äù.',
    apostilaHTML: `
      <p><strong>Painting is not just applying paint</strong>: it‚Äôs preparing the surface, protecting the area, choosing the right product, <strong>properly thinning</strong>, and working safely.</p>
      <h3>üîí Safety (PPE)</h3>
      <p>Essential PPE: <strong>safety goggles</strong>, <strong>respirator/mask</strong>, and <strong>gloves</strong>. Depending on the job: boots, hearing protection, and hard hat.</p>
      <h3>üõ†Ô∏è Materials & Tools</h3>
      <p>Complete kit: sandpapers, scrapers, trowel, rollers, brushes, masking tape/sheet, sealer/primer, filler/compound, <strong>paint</strong>, <strong>thinner</strong>, and PPE. Wall compound is applied with a <strong>spatula and trowel</strong>.</p>
      <h3>üìë Painting Steps</h3>
      <ol>
        <li>Protect the area;</li><li>Repair/level;</li><li>Sand and clean;</li>
        <li>Apply sealer/undercoat;</li><li>Apply compound if needed and sand/clean again;</li>
        <li>Apply finish coats.</li>
      </ol>
      <h3>üé® Paint Types</h3>
      <ul>
        <li><strong>PVA (latex, water-based):</strong> interior masonry; low odor; usually matte.</li>
        <li><strong>Acrylic:</strong> more moisture-resistant and washable; interior/exterior; matte/satin/semi-gloss.</li>
        <li><strong>Synthetic enamel (solvent-based):</strong> wood and metals; use sanding sealer (wood) and anti-corrosive primer/red oxide (metal).</li>
        <li><strong>Epoxy:</strong> high resistance; common on floors, tiles, and prepared metal; often two-component (A+B).</li>
        <li><strong>PU (polyurethane):</strong> very resistant; specific uses.</li>
      </ul>
      <h3>üíß Thinning ‚Äî Quick Guide</h3>
      <p><strong>Thinning</strong> adjusts viscosity, improves coverage and application, <em>avoiding marks and bubbles</em>. Always follow the manufacturer‚Äôs label.</p>
      <table style="width:100%; border-collapse:collapse; font-size:.95em"><thead><tr>
        <th style="border:1px solid #e5e7eb; padding:8px; text-align:left">Type</th>
        <th style="border:1px solid #e5e7eb; padding:8px; text-align:left">Thinner</th>
        <th style="border:1px solid #e5e7eb; padding:8px; text-align:left">% (general)</th>
        <th style="border:1px solid #e5e7eb; padding:8px; text-align:left">Notes</th>
      </tr></thead><tbody>
        <tr><td style="border:1px solid #e5e7eb; padding:8px">PVA (latex/water)</td><td style="border:1px solid #e5e7eb; padding:8px">Clean water</td><td style="border:1px solid #e5e7eb; padding:8px">10‚Äì20%</td><td style="border:1px solid #e5e7eb; padding:8px">Stir well. Adjust to tool (roller/brush/spray).</td></tr>
        <tr><td style="border:1px solid #e5e7eb; padding:8px">Acrylic</td><td style="border:1px solid #e5e7eb; padding:8px">Clean water</td><td style="border:1px solid #e5e7eb; padding:8px">10‚Äì20%</td><td style="border:1px solid #e5e7eb; padding:8px">More moisture-resistant; follow label.</td></tr>
        <tr><td style="border:1px solid #e5e7eb; padding:8px">Synthetic enamel</td><td style="border:1px solid #e5e7eb; padding:8px">Mineral spirits</td><td style="border:1px solid #e5e7eb; padding:8px">5‚Äì15%</td><td style="border:1px solid #e5e7eb; padding:8px"><strong>Never</strong> use water.</td></tr>
        <tr><td style="border:1px solid #e5e7eb; padding:8px">Epoxy (2-part)</td><td style="border:1px solid #e5e7eb; padding:8px">Mix A+B (catalyst)</td><td style="border:1px solid #e5e7eb; padding:8px">Per label</td><td style="border:1px solid #e5e7eb; padding:8px">Respect pot life.</td></tr>
        <tr><td style="border:1px solid #e5e7eb; padding:8px">PU</td><td style="border:1px solid #e5e7eb; padding:8px">Specified solvent</td><td style="border:1px solid #e5e7eb; padding:8px">Per label</td><td style="border:1px solid #e5e7eb; padding:8px">Specific applications.</td></tr>
      </tbody></table>
      <p style="margin-top:8px"><strong>Tip:</strong> for spray/compressor, paint usually needs <em>more</em> thinning than with roller/brush.</p>
      <h3>üåà Colors</h3>
      <p><strong>Primary (pigment):</strong> red, yellow, blue. <strong>Secondary:</strong> orange, green, violet. <strong>Tertiary:</strong> primary + adjacent secondary (e.g., blue-green).</p>
      <h3>‚öôÔ∏è Techniques & Equipment</h3>
      <ul>
        <li>Compressor + spray gun ‚Üí more uniform and faster finish (use respirator and ventilation).</li>
        <li><strong>Airless</strong> equipment: high-pressure atomization without air.</li>
        <li><strong>Coverage</strong>: m¬≤ per liter per coat ‚Äî use the can to estimate quantity.</li>
      </ul>
    `,
    data: [
      { t:"1) Epoxy paint is best suited for:", a:["Dry, low-traffic interior walls","Areas requiring high resistance and easy cleaning (floors, tiles, prepared metals)","Ceilings in living rooms and bedrooms","Exterior decorative textures"], c:1, hint:"Epoxy = high mechanical/chemical resistance; common on floors, tiles, prepared metals." },
      { t:"2) Which PPE are essential for painting?", a:["Goggles, respirator/mask, and gloves","Cap and apron","Hearing protection only","Boots only"], c:0, hint:"Goggles + respirator/mask + gloves form the basic safety trio." },
      { t:"3) To apply wall compound we mainly use:", a:["Wool roller and wide brush","Spatula and trowel","Whitewash brush and spray gun","Brush and compressor"], c:1, hint:"Spatula and trowel spread and level the compound." },
      { t:"4) The most complete painting kit includes:", a:["Roller, paint, and sandpaper","Sandpapers, scrapers, rollers, brushes, tape/sheet, sealer/primer, compound, paint, thinner, and PPE","Only spray gun and compressor","Only latex paint"], c:1, hint:"Think in stages: prepare, protect, and paint." },
      { t:"5) Correct order of steps (interior painting):", a:["Paint ‚Üí sand ‚Üí protect area","Protect ‚Üí repair/level ‚Üí sand/clean ‚Üí sealer ‚Üí compound ‚Üí sand/clean ‚Üí finish coats","Apply finish directly","Sealer last"], c:1, hint:"Preparation and cleaning between steps avoid marks and defects." },
      { t:"6) Common building paint types:", a:["PVA, acrylic, synthetic enamel, epoxy, PU","Gouache and watercolor","Engine thermal paint","Only oil paint"], c:0, hint:"Choice depends on substrate and use (interior/exterior)." },
      { t:"7) PVA latex is:", a:["Solvent-based","Water-based, common for interior masonry","Specific to industrial floors","Only for fa√ßades"], c:1, hint:"Economical, low odor; usually matte for dry interiors." },
      { t:"8) About epoxy paint, it is correct that:", a:["It‚Äôs always single-component","It can be two-component (A+B) with high resistance","It‚Äôs only for ceilings","It doesn‚Äôt adhere to metals"], c:1, hint:"Respect pot life when mixing parts." },
      { t:"9) Acrylic paint stands out for:", a:["Lower moisture resistance than PVA","Higher moisture resistance and washability; fit for interiors and exteriors","Use only on wood","Not supporting different finishes"], c:1, hint:"Available in matte, satin, and semi-gloss." },
      { t:"10) Synthetic enamel is recommended for:", a:["Wood and metals","Bare plaster","Wall textures","Industrial floors"], c:0, hint:"Use sanding sealer (wood) and anti-corrosive primer (metal)." },
      { t:"11) Red oxide (zarc√£o) is:", a:["A water-based paint","An anti-corrosive primer for steel","A type of sandpaper","A drying additive"], c:1, hint:"Protects metal against rust before finishing." },
      { t:"12) Correct thinning for synthetic enamel:", a:["Water","Mineral spirits, per label","Neutral detergent","Always thinner, without checking the can"], c:1, hint:"Solvent-based paints must not be thinned with water." },
      { t:"13) Primary colors (pigment system):", a:["Cyan, magenta, and yellow","Red, yellow, and blue","Black, white, and gray","Green, orange, and purple"], c:1, hint:"In this didactic context, we use red, yellow, and blue." },
      { t:"14) Common ‚Äúlines‚Äù of paints:", a:["Synthetic enamel, PVA latex, acrylic, epoxy, PU","Tempera and gouache","Only pearlescent automotive","Bitumen and grease"], c:0, hint:"Product families by use/finish." },
      { t:"15) Secondary colors are formed by:", a:["Mixing two primaries","Mixing black and white","Primary with black","Random mixing"], c:0, hint:"Orange, green, violet." },
      { t:"16) Example of a tertiary color:", a:["Pure blue","Reddish-violet (primary + adjacent secondary)","Black","White"], c:1, hint:"Primary + neighboring secondary." },
      { t:"17) Advantage of a home compressor:", a:["Reduces PPE needs","Enables spray gun with uniform, fast finish","Eliminates surface prep","Replaces sealer"], c:1, hint:"Productivity with respiratory safety." },
      { t:"18) ‚ÄúCoverage/yield‚Äù means:", a:["Touch-dry time","Area covered per liter per coat (m¬≤/L/coat)","Amount of solvent","Roller nap thickness"], c:1, hint:"Use the can‚Äôs yield to calculate quantity." },
      { t:"19) Complete: Primary colors are considered ________.", a:["secondary","matrices (mother colors)","pastels","complementaries"], c:1, hint:"Also called mother colors." },
      { t:"20) Complete: These are __________ systems, ‚Äúair-free‚Äù.", a:["HVLP","airless","turbo","centrifugal"], c:1, hint:"Airless = high-pressure spray without air mixing." },
    ]
  },

  es: {
    htmlLang: 'es',
    docTitle: 'Renova DF ‚Äî Pintura | Apunte + Quiz Biling√ºe con Audio',
    headerTitle: 'Nociones de Pintura ‚Äî Apunte + Quiz',
    headerSubtitle: '(Lee el apunte para desbloquear el quiz)',
    gateTitle: 'Apunte (lectura obligatoria)',
    gateStatusPending: 'Lectura pendiente',
    gateStatusDone: 'Lectura confirmada',
    readConfirmLabel: 'Le√≠ el apunte y estoy listo(a) para empezar el quiz.',
    startQuiz: 'Empezar el quiz',
    printApostila: 'üñ®Ô∏è Imprimir/Guardar PDF',
    scrollHint: 'Despl√°zate hasta el final para habilitar la confirmaci√≥n.',
    playApostila: 'üîä Leer solo el apunte',
    playAll: 'üîä Leer todo',
    stop: '‚èπÔ∏è Detener',
    dark: 'üåô Modo oscuro',
    instructions: 'Instrucciones',
    instText: `
      <ol style="padding-left:18px; margin-top:6px">
        <li>Lee el apunte hasta el final y marca ‚ÄúLe√≠ el apunte‚Äù.</li>
        <li>Haz clic en <strong>Empezar el quiz</strong> para desbloquear preguntas e iniciar el cron√≥metro.</li>
        <li>En cada pregunta, toca <strong>üîà</strong> para escuchar y <strong>üí°</strong> para una pista.</li>
        <li>Al terminar, pulsa <strong>‚úÖ Finalizar</strong> (al final de la p√°gina) para corregir, puntuar y detener el tiempo.</li>
        <li>Completa tu <strong>nombre</strong> y <strong>turno</strong>, luego pulsa <strong>‚úîÔ∏è Recibir visto & enviar</strong> para registrar en la hoja.</li>
      </ol>
    `,
    keyBtn: 'üìò Gabarito',
    resetBtn: '‚Ü©Ô∏è Reiniciar',
    scoreLabel: 'Puntuaci√≥n',
    timerLabel: 'Tiempo',
    finalizeBtn: '‚úÖ Finalizar',
    markSeenBtn: '‚úîÔ∏è Recibir visto & enviar',
    markSeenDone: '‚úîÔ∏è Visto registrado',
    seenTitle: 'Registro confirmado',
    seenBody: (nota, datahora) => `Tu puntuaci√≥n es <strong>${nota}</strong> y el visto fue registrado el <strong>${datahora}</strong>.`,
    alerts: {
      fillNamePeriod: 'Completa nombre y turno antes de enviar.',
      sendSuccess: 'Visto registrado y resultado enviado a la hoja.',
      sendFail: 'No fue posible enviar ahora. Revisa internet/endpoint.',
      answerAll: 'Responde todas las preguntas antes de finalizar.',
      keyAfterFinish: 'El gabarito solo puede mostrarse despu√©s de finalizar el quiz.'
    },
    printTitle: 'Renova DF ‚Äî Gabarito',
    phAlunoLbl: 'Estudiante:',
    phPeriodoLbl: 'Turno:',
    phDataLbl: 'Fecha:',
    phTempoLbl: 'Tiempo:',
    phNotaLbl: 'Puntuaci√≥n:',
    identTitle: 'Identificaci√≥n',
    labelAluno: 'Nombre completo',
    labelPeriodo: 'Turno',
    optSelecione: 'Seleccionar‚Ä¶',
    optManha: 'Ma√±ana',
    optTarde: 'Tarde',
    optNoite: 'Noche',
    optIntegral: 'Jornada completa',
    sayIcon: 'üîà',
    hintIcon: 'üí°',
    voice: 'es-ES',
    afterTip: 'Consejo: al finalizar, revisa tu puntuaci√≥n y, si ya completaste nombre y turno, pulsa ‚ÄúRecibir visto & enviar‚Äù.',
    apostilaHTML: `
      <p><strong>Pintar no es solo aplicar pintura</strong>: es preparar la superficie, proteger el ambiente, elegir el producto correcto, <strong>diluir adecuadamente</strong> y trabajar con seguridad.</p>
      <h3>üîí Seguridad (EPP)</h3>
      <p>EPP esenciales: <strong>gafas de seguridad</strong>, <strong>respirador/mascarilla</strong> y <strong>guantes</strong>. Seg√∫n el servicio: botas, protector auditivo y casco.</p>
      <h3>üõ†Ô∏è Materiales y Herramientas</h3>
      <p>Kit completo: lijas, esp√°tulas, llana, rodillos, brochas, cinta/lona, sellador/imprimaci√≥n, masilla, <strong>pintura</strong>, <strong>diluyente</strong> y EPP. La masilla se aplica con <strong>esp√°tula y llana</strong>.</p>
      <h3>üìë Etapas de la Pintura</h3>
      <ol>
        <li>Proteger el ambiente;</li><li>Corregir/alisar;</li><li>Lijar y limpiar;</li>
        <li>Aplicar sellador/fondo;</li><li>Aplicar masilla si es necesario y lijar/limpiar nuevamente;</li>
        <li>Aplicar manos de acabado.</li>
      </ol>
      <h3>üé® Tipos de pintura</h3>
      <ul>
        <li><strong>PVA (l√°tex, base agua):</strong> interiores de alba√±iler√≠a; bajo olor; generalmente mate.</li>
        <li><strong>Acr√≠lica:</strong> m√°s resistente a la humedad y lavable; interior/exterior; mate/satinada/semi-brillo.</li>
        <li><strong>Esmalte sint√©tico (base solvente):</strong> madera y metales; usar selladora (madera) y fondo anticorrosivo/√≥xido rojo (metal).</li>
        <li><strong>Epoxi:</strong> alta resistencia; com√∫n en pisos, azulejos y metales preparados; a menudo bicomponente (A+B).</li>
        <li><strong>PU:</strong> muy resistente; usos espec√≠ficos.</li>
      </ul>
      <h3>üíß Diluci√≥n ‚Äî Gu√≠a r√°pida</h3>
      <p>La <strong>diluci√≥n</strong> ajusta la viscosidad, mejora el rendimiento y la aplicaci√≥n, <em>evitando marcas y burbujas</em>. Sigue siempre la etiqueta del fabricante.</p>
      <table style="width:100%; border-collapse:collapse; font-size:.95em"><thead><tr>
        <th style="border:1px solid #e5e7eb; padding:8px; text-align:left">Tipo</th>
        <th style="border:1px solid #e5e7eb; padding:8px; text-align:left">Diluyente</th>
        <th style="border:1px solid #e5e7eb; padding:8px; text-align:left">% (general)</th>
        <th style="border:1px solid #e5e7eb; padding:8px; text-align:left">Observaciones</th>
      </tr></thead><tbody>
        <tr><td style="border:1px solid #e5e7eb; padding:8px">PVA (l√°tex/agua)</td><td style="border:1px solid #e5e7eb; padding:8px">Agua limpia</td><td style="border:1px solid #e5e7eb; padding:8px">10‚Äì20%</td><td style="border:1px solid #e5e7eb; padding:8px">Agitar bien. Ajustar a la herramienta.</td></tr>
        <tr><td style="border:1px solid #e5e7eb; padding:8px">Acr√≠lica</td><td style="border:1px solid #e5e7eb; padding:8px">Agua limpia</td><td style="border:1px solid #e5e7eb; padding:8px">10‚Äì20%</td><td style="border:1px solid #e5e7eb; padding:8px">M√°s resistente a la humedad.</td></tr>
        <tr><td style="border:1px solid #e5e7eb; padding:8px">Esmalte sint√©tico</td><td style="border:1px solid #e5e7eb; padding:8px">Aguarr√°s</td><td style="border:1px solid #e5e7eb; padding:8px">5‚Äì15%</td><td style="border:1px solid #e5e7eb; padding:8px"><strong>Nunca</strong> usar agua.</td></tr>
        <tr><td style="border:1px solid #e5e7eb; padding:8px">Epoxi (2 comp.)</td><td style="border:1px solid #e5e7eb; padding:8px">Mezcla A+B</td><td style="border:1px solid #e5e7eb; padding:8px">Seg√∫n etiqueta</td><td style="border:1px solid #e5e7eb; padding:8px">Respetar el <em>pot life</em>.</td></tr>
        <tr><td style="border:1px solid #e5e7eb; padding:8px">PU</td><td style="border:1px solid #e5e7eb; padding:8px">Solvente indicado</td><td style="border:1px solid #e5e7eb; padding:8px">Seg√∫n etiqueta</td><td style="border:1px solid #e5e7eb; padding:8px">Aplicaciones espec√≠ficas.</td></tr>
      </tbody></table>
      <p style="margin-top:8px"><strong>Consejo:</strong> para pistola/compresor, la pintura suele requerir <em>m√°s</em> diluci√≥n que con rodillo/brocha.</p>
      <h3>üåà Colores</h3>
      <p><strong>Primarios (pigmento):</strong> rojo, amarillo y azul. <strong>Secundarios:</strong> naranja, verde, violeta. <strong>Terciarios:</strong> primario + secundario adyacente (p. ej., azul verdoso).</p>
      <h3>‚öôÔ∏è T√©cnicas y Equipos</h3>
      <ul>
        <li>Compresor + pistola ‚Üí acabado m√°s uniforme y r√°pido (usar respirador y ventilaci√≥n).</li>
        <li>Equipos <strong>airless</strong>: pulverizaci√≥n a alta presi√≥n sin aire.</li>
        <li><strong>Rendimiento</strong>: m¬≤ por litro por mano ‚Äî usa el envase para calcular la cantidad.</li>
      </ul>
    `,
    data: [
      { t:"1) La pintura epoxi es m√°s indicada para:", a:["Paredes interiores secas de bajo tr√°fico","√Åreas que requieren alta resistencia y f√°cil limpieza (pisos, azulejos, metales preparados)","Cielos rasos de salas y dormitorios","Texturas decorativas exteriores"], c:1, hint:"Epoxi = alta resistencia mec√°nica/qu√≠mica; com√∫n en pisos, azulejos y metales preparados." },
      { t:"2) ¬øQu√© EPP son esenciales en pintura?", a:["Gafas, respirador/mascarilla y guantes","Gorro y delantal","Solo protector auditivo","Solo botas"], c:0, hint:"Gafas + respirador/mascarilla + guantes forman el tr√≠o b√°sico de seguridad." },
      { t:"3) Para aplicar masilla usamos principalmente:", a:["Rodillo de lana y brocha ancha","Esp√°tula y llana","Brocha de cal y pistola","Brocha y compresor"], c:1, hint:"Esp√°tula y llana distribuyen y nivelan la masilla." },
      { t:"4) Conjunto m√°s completo para pintar:", a:["Rodillo, pintura y lija","Lijas, esp√°tulas, rodillos, brochas, cinta/lona, sellador/imprimaci√≥n, masilla, pintura, diluyente y EPP","Solo pistola y compresor","Solo pintura l√°tex"], c:1, hint:"Organiza por etapas: preparar, proteger y pintar." },
      { t:"5) Orden correcto de etapas (pintura interior):", a:["Pintar ‚Üí lijar ‚Üí proteger ambiente","Proteger ‚Üí corregir/alisar ‚Üí lijar/limpiar ‚Üí sellador ‚Üí masilla ‚Üí lijar/limpiar ‚Üí manos de acabado","Aplicar acabado directo","Sellador al final"], c:1, hint:"Preparaci√≥n y limpieza entre etapas evitan marcas y fallas." },
      { t:"6) Tipos de pintura en construcci√≥n:", a:["PVA, acr√≠lica, esmalte sint√©tico, epoxi, PU","T√©mpera y acuarela","Pintura t√©rmica de motor","Solo √≥leo"], c:0, hint:"La elecci√≥n depende del sustrato y del uso (interior/exterior)." },
      { t:"7) L√°tex PVA es:", a:["A base de solvente","A base de agua, com√∫n en interiores de alba√±iler√≠a","Espec√≠fico para pisos industriales","Solo fachadas"], c:1, hint:"Econ√≥mico, bajo olor; usualmente mate para interiores secos." },
      { t:"8) Sobre la pintura epoxi, es correcto:", a:["Siempre es monocomponente","Puede ser bicomponente (A+B) y tiene alta resistencia","Solo indicada para cielos rasos","No se adhiere a metales"], c:1, hint:"Respeta el pot life al mezclar las partes." },
      { t:"9) La pintura acr√≠lica destaca por:", a:["Menor resistencia a la humedad que el PVA","Mayor resistencia a la humedad y lavabilidad; sirve para interiores y exteriores","Usarse solo en madera","No admitir diferentes acabados"], c:1, hint:"Disponible en mate, satinado y semibrillo." },
      { t:"10) El esmalte sint√©tico se recomienda para:", a:["Madera y metales","Yeso crudo","Texturas de pared","Pisos industriales"], c:0, hint:"Usa selladora (madera) y fondo anticorrosivo (metal)." },
      { t:"11) El √≥xido rojo (zarc√≥n) es:", a:["Una pintura a base de agua","Un fondo/primer anticorrosivo para acero","Un tipo de lija","Un aditivo de secado"], c:1, hint:"Protege el metal contra la corrosi√≥n antes del acabado." },
      { t:"12) Diluci√≥n correcta del esmalte sint√©tico:", a:["Agua","Aguarr√°s (disolvente mineral), seg√∫n etiqueta","Detergente neutro","Siempre thinner, sin consultar el envase"], c:1, hint:"Las pinturas base solvente no deben diluirse con agua." },
      { t:"13) Colores primarios (sistema pigmento):", a:["Cian, magenta y amarillo","Rojo, amarillo y azul","Negro, blanco y gris","Verde, naranja y morado"], c:1, hint:"En este contexto did√°ctico usamos rojo, amarillo y azul." },
      { t:"14) ‚ÄúL√≠neas‚Äù de pinturas comunes:", a:["Esmalte sint√©tico, l√°tex PVA, acr√≠lica, epoxi, PU","T√©mpera y gouache","Automotriz perlada √∫nicamente","Bet√∫n y grasa"], c:0, hint:"Familias de productos por uso/acabado." },
      { t:"15) Los colores secundarios se forman por:", a:["Mezcla de dos primarios","Mezcla de negro con blanco","Primario con negro","Mezcla aleatoria"], c:0, hint:"Naranja, verde y violeta." },
      { t:"16) Ejemplo de color terciario:", a:["Azul puro","Rojo-viol√°ceo (primario + secundario adyacente)","Negro","Blanco"], c:1, hint:"Primario + secundario vecino." },
      { t:"17) Ventaja del compresor dom√©stico:", a:["Reduce EPP","Permite pistola (spray) con acabado uniforme y r√°pido","Elimina la preparaci√≥n de la superficie","Sustituye el sellador"], c:1, hint:"Productividad con seguridad respiratoria." },
      { t:"18) ‚ÄúRendimiento‚Äù significa:", a:["Tiempo de secado al tacto","Superficie cubierta por litro por mano (m¬≤/L/mano)","Cantidad de solvente","Grosor del rodillo"], c:1, hint:"Usa el rendimiento del envase para calcular la cantidad." },
      { t:"19) Completa: Los colores primarios se consideran ________.", a:["secundarios","matrices (colores madre)","pasteles","complementarios"], c:1, hint:"Tambi√©n llamados colores madre." },
      { t:"20) Completa: Son equipos con sistema __________, ‚Äúsin aire‚Äù.", a:["HVLP","airless","turbo","centr√≠fugo"], c:1, hint:"Airless = pulverizaci√≥n a alta presi√≥n sin mezcla de aire." },
    ]
  }
};
</script>

<script>
/* =========================
   STATE & ELEMENTS
   ========================= */
let currentLang = 'pt';
const sec = document.getElementById('sections');
const scoreCard = document.getElementById('scoreCard');
const identCard = document.getElementById('identCard');
const instCard  = document.getElementById('instCard');
const actionsCard = document.getElementById('actionsCard');
let userAnswers = [];
let isFinalized = false;

/* ====== Gate elements ====== */
const gateCard   = document.getElementById('gateCard');
const gateBox    = document.getElementById('gateBox');
const gateTitle  = document.getElementById('gateTitle');
const gateStatus = document.getElementById('gateStatus');
const readConfirm= document.getElementById('readConfirm');
const readLabel  = document.getElementById('readConfirmLabel');
const startQuiz  = document.getElementById('startQuiz');
const printAp    = document.getElementById('printApostila');
const scrollHint = document.getElementById('scrollHint');

/* ====== Header controls ====== */
const langSel      = document.getElementById('lang');
const playApostila = document.getElementById('playApostila');
const playAll      = document.getElementById('playAll');
const stopBtn      = document.getElementById('stopVoice');
const darkBtn      = document.getElementById('toggleDark');

/* ====== Score elements ====== */
const scoreTitle = document.getElementById('scoreTitle');
const scoreText  = document.getElementById('scoreText');
const scoreTotal = document.getElementById('scoreTotal');
const timerLabel = document.getElementById('timerLabel');
const timerEl    = document.getElementById('timer');

/* ====== Ident & print header ====== */
const identTitle = document.getElementById('identTitle');
const labelAluno = document.getElementById('labelAluno');
const labelPeriodo = document.getElementById('labelPeriodo');
const optSelecione = document.getElementById('optSelecione');
const optManha = document.getElementById('optManha');
const optTarde = document.getElementById('optTarde');
const optNoite = document.getElementById('optNoite');
const optIntegral = document.getElementById('optIntegral');
const printTitle  = document.getElementById('printTitle');
const phAlunoLbl  = document.getElementById('phAlunoLbl');
const phPeriodoLbl= document.getElementById('phPeriodoLbl');
const phDataLbl   = document.getElementById('phDataLbl');
const phTempoLbl  = document.getElementById('phTempoLbl');
const phNotaLbl   = document.getElementById('phNotaLbl');
const phAluno     = document.getElementById('phAluno');
const phPeriodo   = document.getElementById('phPeriodo');
const phData      = document.getElementById('phData');
const phTempo     = document.getElementById('phTempo');
const phNota      = document.getElementById('phNota');

/* ====== Bottom action buttons ====== */
const finalizeBtn  = document.getElementById('finalizeQuiz');
const keyBtn       = document.getElementById('showKey');
const resetBtn     = document.getElementById('resetQuiz');
const markSeenBtn  = document.getElementById('markSeen');
const afterTip     = document.getElementById('afterTip');

/* ====== Seen banner ====== */
const seenBanner = document.getElementById('seenBanner');
const seenTitle  = document.getElementById('seenTitle');
const seenBody   = document.getElementById('seenBody');

/* ====== Timer state ====== */
let timerInt = null;
let elapsedSec = 0;
function mmss(s){ const m=Math.floor(s/60),r=s%60; return `${String(m).padStart(2,'0')}:${String(r).padStart(2,'0')}`; }
function startTimer(){ clearInterval(timerInt); elapsedSec=0; timerEl.textContent='00:00'; timerInt=setInterval(()=>{ elapsedSec++; timerEl.textContent=mmss(elapsedSec); },1000); }
function pauseTimer(){ if(timerInt){ clearInterval(timerInt); timerInt=null; } }
function resetTimerUI(){ clearInterval(timerInt); timerInt=null; elapsedSec=0; timerEl.textContent='00:00'; }

/* =========================
   LANGUAGE / BUILD
   ========================= */
function setLang(lang){
  currentLang = lang;
  const L = I18N[lang];

  document.documentElement.lang = L.htmlLang;
  document.title = L.docTitle;
  document.getElementById('mainTitle').childNodes[0].nodeValue = L.headerTitle + ' ';
  document.getElementById('subtitle').textContent = L.headerSubtitle;

  gateTitle.textContent = L.gateTitle;
  gateStatus.textContent = L.gateStatusPending;
  readLabel.textContent = L.readConfirmLabel;
  startQuiz.textContent = L.startQuiz;
  printAp.textContent   = L.printApostila;
  scrollHint.textContent= L.scrollHint;

  playApostila.textContent = L.playApostila;
  playAll.textContent      = L.playAll;
  document.getElementById('stopVoice').textContent = L.stop;
  document.getElementById('toggleDark').textContent = L.dark;

  // Instru√ß√µes e rodap√©
  document.getElementById('instTitle').textContent = L.instructions;
  document.getElementById('instText').innerHTML = L.instText;
  keyBtn.textContent      = L.keyBtn;
  resetBtn.textContent    = L.resetBtn;
  finalizeBtn.textContent = L.finalizeBtn;
  markSeenBtn.textContent = L.markSeenBtn;
  afterTip.textContent = L.afterTip;

  // Score labels
  scoreTitle.textContent = L.scoreLabel;
  timerLabel.textContent = L.timerLabel;

  // Ident i18n
  identTitle.textContent = L.identTitle;
  labelAluno.textContent = L.labelAluno;
  labelPeriodo.textContent = L.labelPeriodo;
  optSelecione.textContent = L.optSelecione;
  optManha.textContent = L.optManha;
  optTarde.textContent = L.optTarde;
  optNoite.textContent = L.optNoite;
  optIntegral.textContent = L.optIntegral;

  // Print header i18n
  printTitle.textContent = L.printTitle;
  phAlunoLbl.textContent = L.phAlunoLbl;
  phPeriodoLbl.textContent = L.phPeriodoLbl;
  phDataLbl.textContent = L.phDataLbl;
  phTempoLbl.textContent = L.phTempoLbl;
  phNotaLbl.textContent  = L.phNotaLbl;

  // Build apostila e quest√µes
  gateBox.innerHTML = L.apostilaHTML;
  sec.innerHTML = '';
  (L.data || []).forEach((q,idx)=>{
    const art=document.createElement('article');
    art.className='card';
    const opts = q.a.map((x,i)=>`<label class="option"><input type='radio' name='q${idx}' value='${i}'> ${x}</label>`).join('');
    art.innerHTML=`<p class="question">${q.t}</p>
      <button class="speak" aria-label="speak" data-say="${q.t} ${q.a.join(', ')}">${L.sayIcon}</button>
      <button class="hint-btn" aria-label="hint" data-hint="${q.hint}">${L.hintIcon}</button>
      <div class="options" data-correct="${q.c}">${opts}</div>
      <div class="hint-text" id="hint${idx}">${q.hint}</div>`;
    sec.appendChild(art);
  });
  bindDynamicHandlers();

  // Estado inicial do quiz
  userAnswers = Array((L.data || []).length).fill(-1);
  scoreText.textContent = '‚Äî';
  scoreTotal.textContent = (L.data || []).length;
  isFinalized = false;
  finalizeBtn.disabled = false;
  markSeenBtn.disabled = true;
  seenBanner.style.display = 'none';

  applyGateSavedState();
}

/* =========================
   SPEAK
   ========================= */
function speak(text){
  if(!('speechSynthesis' in window)) return;
  speechSynthesis.cancel();
  const u=new SpeechSynthesisUtterance(text);
  u.lang = I18N[currentLang].voice;
  const voices = speechSynthesis.getVoices();
  const desired = voices.find(v=>v.lang && v.lang.startsWith(I18N[currentLang].voice.split('-')[0]));
  if(desired) u.voice = desired;
  speechSynthesis.speak(u);
}
function speakLong(text){
  if(!('speechSynthesis' in window)) return;
  speechSynthesis.cancel();
  const lang = I18N[currentLang].voice;
  const voices = speechSynthesis.getVoices();
  const desired = voices.find(v=>v.lang && v.lang.startsWith(lang.split('-')[0]));
  const chunks = (text || '').match(/.{1,250}(\s|$)/g) || [text];
  chunks.forEach(chunk=>{
    const u = new SpeechSynthesisUtterance(chunk);
    u.lang = lang;
    if(desired) u.voice = desired;
    speechSynthesis.speak(u);
  });
}

/* =========================
   QUIZ BINDINGS (sem revelar antes)
   ========================= */
function bindDynamicHandlers(){
  document.querySelectorAll('.speak').forEach(btn=>btn.onclick=()=>speak(btn.dataset.say));
  document.querySelectorAll('.hint-btn').forEach(btn=>btn.onclick=()=>{
    const card = btn.closest('article');
    const name = card.querySelector('input')?.name || 'q0';
    const idx = name.replace('q','');
    const t=document.getElementById('hint'+idx);
    t.classList.toggle('show');
    if(t.classList.contains('show')) speak(t.textContent);
  });
  // Somente registra sele√ß√£o; n√£o bloqueia nem mostra correto/incorreto
  document.querySelectorAll('.options').forEach((optGroup, qIdx)=>{
    optGroup.querySelectorAll('input[type="radio"]').forEach(input=>{
      input.onchange = () => {
        if(isFinalized) return;
        userAnswers[qIdx] = parseInt(input.value,10);
      };
    });
  });
}

function allAnswered(){
  return userAnswers.every(v=>v!==-1);
}

function updateScoreFinal(){
  const L = I18N[currentLang];
  const got = userAnswers.reduce((s,v,i)=> s + (v===L.data?.[i]?.c ? 1 : 0), 0);
  scoreText.textContent = got;
}

/* ========= FINALIZAR ========= */
function finalizeQuiz(){
  if(isFinalized) return;
  if(!allAnswered()){
    alert(I18N[currentLang].alerts.answerAll);
    return;
  }
  // Travar inputs e revelar gabarito
  document.querySelectorAll('.options').forEach((optGroup, qIdx)=>{
    const correct = parseInt(optGroup.dataset.correct,10);
    const labels = [...optGroup.querySelectorAll('.option')];
    const inputs = [...optGroup.querySelectorAll('input')];
    inputs.forEach(i=>i.disabled=true);
    labels.forEach(l=>l.classList.remove('correct','incorrect'));
    const chosenVal = userAnswers[qIdx];
    labels[correct]?.classList.add('correct');
    if(chosenVal !== correct){ labels[chosenVal]?.classList.add('incorrect'); }
  });

  updateScoreFinal();
  pauseTimer();
  fillPrintHeader();

  isFinalized = true;
  finalizeBtn.disabled = true;
  markSeenBtn.disabled = false;

  window.scrollTo({top: scoreCard.offsetTop - 10, behavior:'smooth'});
}

/* ====== Answer key (apenas ap√≥s finalizar) ====== */
function showAnswerKey(){
  if(!isFinalized){
    alert(I18N[currentLang].alerts.keyAfterFinish);
    return;
  }
  // j√° est√° mostrado no finalize; mantido por compatibilidade
}

/* ====== Reset ====== */
function resetQuiz(){
  const L = I18N[currentLang];
  document.querySelectorAll('.options').forEach((optGroup)=>{
    optGroup.querySelectorAll('input').forEach(i=>{ i.disabled=false; i.checked=false; });
    optGroup.querySelectorAll('.option').forEach(l=>l.classList.remove('correct','incorrect'));
  });
  userAnswers = Array((L.data || []).length).fill(-1);
  scoreText.textContent = '‚Äî';
  resetTimerUI();
  isFinalized = false;
  finalizeBtn.disabled = false;
  markSeenBtn.disabled = true;
  markSeenBtn.textContent = L.markSeenBtn;
  fillPrintHeader();
  seenBanner.style.display = 'none';
}

/* ====== Print header fill ====== */
function fillPrintHeader(){
  const L = I18N[currentLang];
  printTitle.textContent = L.printTitle;
  phAlunoLbl.textContent = L.phAlunoLbl;
  phPeriodoLbl.textContent = L.phPeriodoLbl;
  phDataLbl.textContent = L.phDataLbl;
  phTempoLbl.textContent = L.phTempoLbl;
  phNotaLbl.textContent  = L.phNotaLbl;

  const aluno = document.getElementById('aluno')?.value?.trim() || '‚Äî';
  const periodoSel = document.getElementById('periodo');
  const periodo = (periodoSel && periodoSel.value) ? periodoSel.value : '‚Äî';
  const nowStr = new Date().toLocaleString(document.documentElement.lang || L.htmlLang || 'pt-BR');

  phAluno.textContent   = aluno;
  phPeriodo.textContent = periodo;
  phData.textContent    = nowStr;
  phTempo.textContent   = timerEl.textContent || '00:00';
  phNota.textContent    = `${scoreText.textContent}/${scoreTotal.textContent}`;
}

/* ====== Confete ====== */
function makeConfetti(){
  const box = document.getElementById('confettiBox'); if(!box) return;
  box.innerHTML = '';
  const pieces = 50;
  const shapes = ['‚óÜ','‚óè','‚ñ†','‚ñ≤','‚òÖ'];
  for(let i=0;i<pieces;i++){
    const iEl = document.createElement('i');
    iEl.textContent = shapes[Math.floor(Math.random()*shapes.length)];
    iEl.style.left = Math.random()*100 + 'vw';
    iEl.style.fontSize = (Math.random()*18+10) + 'px';
    iEl.style.opacity = .7 + Math.random()*.3;
    iEl.style.animationDelay = (Math.random()*0.8)+'s';
    box.appendChild(iEl);
  }
}

/* ====== Envio para planilha (√∫nico) + Modal ====== */
function openModal(){ const el = document.getElementById('modalVisto'); if(el){ el.style.display='flex'; makeConfetti(); } }
function closeModal(){ const el = document.getElementById('modalVisto'); if(el){ el.style.display='none'; } }

function vistoKeyFor(aluno, turno, quiz){
  const raw = `${(aluno||'').toLowerCase().trim()}|${(turno||'').toLowerCase().trim()}|${(quiz||'').toLowerCase().trim()}`;
  return 'renova_visto_' + btoa(unescape(encodeURIComponent(raw)));
}

async function enviarParaPlanilha() {
  const L = I18N[currentLang];
  const quizName = `${L.headerTitle} (${currentLang.toUpperCase()})`;
  const aluno = (document.getElementById('aluno')?.value || '').trim();
  const turno = (document.getElementById('periodo')?.value || '').trim();
  const nota  = `${document.getElementById('scoreText').textContent}/${document.getElementById('scoreTotal').textContent}`;
  const datahora = new Date().toLocaleString(document.documentElement.lang || L.htmlLang || 'pt-BR');
  const statusEl = document.getElementById('vistoStatus');

  if (!aluno || !turno) { alert(L.alerts.fillNamePeriod); return; }

  // Abre modal imediatamente
  statusEl.textContent = 'Enviando‚Ä¶';
  openModal();

  const key = vistoKeyFor(aluno, turno, quizName);
  if(localStorage.getItem(key)){
    // J√° registrado: s√≥ informa e n√£o envia de novo
    statusEl.textContent = 'Seu visto j√° havia sido registrado anteriormente ‚úÖ';
  } else {
    try{
      await fetch(SHEETS_ENDPOINT, {
        method: 'POST',
        mode: 'no-cors',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ quiz: quizName, aluno, nota, datahora, turno })
      });
      localStorage.setItem(key, '1');
      statusEl.textContent = 'Registro conclu√≠do com sucesso na planilha ‚úÖ';
    }catch(e){
      statusEl.textContent = 'N√£o foi poss√≠vel registrar agora. Tente novamente mais tarde.';
    }
  }

  // Atualiza UI final (banner, bot√£o, etc.)
  markSeenBtn.disabled = true;
  markSeenBtn.textContent = L.markSeenDone;
  seenTitle.textContent = L.seenTitle;
  seenBody.innerHTML = L.seenBody(nota, datahora);
  seenBanner.style.display = '';
  alert(L.alerts.sendSuccess);
}

/* =========================
   Gate behavior + views
   ========================= */
const STORAGE_KEY = 'renovadf_pintura_read_v7';

function applyGateSavedState(){
  const saved = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
  const langSaved = saved[currentLang] === true;
  if(langSaved){
    gateStatus.textContent = I18N[currentLang].gateStatusDone;
    readConfirm.checked = true;
    readConfirm.disabled = false;
    startQuiz.disabled = false;
    playAll.disabled = false;
    openQuizView();
  }else{
    gateStatus.textContent = I18N[currentLang].gateStatusPending;
    readConfirm.checked = false;
    readConfirm.disabled = true;
    startQuiz.disabled = true;
    playAll.disabled = true;
    closeQuizView();
  }
}

function openQuizView(){
  scoreCard.style.display = '';
  identCard.style.display = '';
  instCard.style.display  = '';
  sec.style.display = '';
  actionsCard.style.display = '';
}

function closeQuizView(){
  scoreCard.style.display = 'none';
  identCard.style.display = 'none';
  instCard.style.display  = 'none';
  sec.style.display = 'none';
  actionsCard.style.display = 'none';
}

function saveGate(){
  const saved = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
  saved[currentLang] = true;
  localStorage.setItem(STORAGE_KEY, JSON.stringify(saved));
}

gateBox.addEventListener('scroll', ()=>{
  const atBottom = gateBox.scrollTop + gateBox.clientHeight >= gateBox.scrollHeight - 8;
  if(atBottom){
    readConfirm.disabled = false;
    scrollHint.style.opacity = .6;
  }
});
readConfirm.addEventListener('change', ()=>{
  startQuiz.disabled = !readConfirm.checked;
  playAll.disabled = !readConfirm.checked;
});
startQuiz.addEventListener('click', ()=>{
  if(!readConfirm.checked) return;
  saveGate();
  gateStatus.textContent = I18N[currentLang].gateStatusDone;
  openQuizView();
  isFinalized = false;
  finalizeBtn.disabled = false;
  markSeenBtn.disabled = true;
  seenBanner.style.display = 'none';
  scoreText.textContent = '‚Äî';
  startTimer();
  window.scrollTo({top: scoreCard.offsetTop - 10, behavior:'smooth'});
});

/* =========================
   Top-level handlers
   ========================= */
langSel.addEventListener('change', (e)=> setLang(e.target.value));
playApostila.onclick = () => {
  const L = I18N[currentLang];
  const apTitle = L.gateTitle || '';
  const apText  = (gateBox?.innerText || '').replace(/\s+\n/g, '\n').trim();
  const parts = [L.headerTitle];
  if (apText) parts.push(apTitle, apText);
  speakLong(parts.join('. '));
};
playAll.onclick = () => {
  if (playAll.disabled) return;
  const L = I18N[currentLang];
  const apTitle = L.gateTitle || '';
  const apText  = (gateBox?.innerText || '').replace(/\s+\n/g, '\n').trim();
  const inst = `${L.instructions}. ${(document.getElementById('instText')?.innerText || '')}`.trim();
  const questions = (L.data || []).map(q => `${q.t} ${q.a.join(', ')}`).join('. ');
  const parts = [L.headerTitle];
  if (apText) parts.push(apTitle, apText);
  if (sec.style.display !== 'none') { parts.push(inst); if (questions) parts.push(questions); }
  speakLong(parts.join('. '));
};
stopBtn.onclick=()=>speechSynthesis.cancel();
let fontScale=1;
function applyFont(){ document.documentElement.style.setProperty('--fontScale', fontScale); }
document.getElementById('fontPlus').onclick=()=>{ fontScale+=0.1; applyFont(); };
document.getElementById('fontMinus').onclick=()=>{ fontScale=Math.max(0.8, fontScale-0.1); applyFont(); };

const scrollBtn=document.getElementById('scrollTop');
window.addEventListener('scroll',()=>{ scrollBtn.style.display = window.scrollY>200 ? 'block' : 'none'; });
scrollBtn.onclick=()=> window.scrollTo({top:0,behavior:'smooth'});

/* Click handlers (rodap√©) */
document.getElementById('showKey').onclick = ()=> showAnswerKey();
document.getElementById('resetQuiz').onclick = ()=> resetQuiz();
document.getElementById('finalizeQuiz').onclick = ()=> finalizeQuiz();
document.getElementById('markSeen').onclick = ()=> enviarParaPlanilha();

/* Dark mode toggle */
darkBtn.onclick=()=>{ document.body.classList.toggle('dark'); };

/* Print */
printAp.addEventListener('click', ()=> window.print());

/* Ensure voices are loaded */
if ('speechSynthesis' in window) { speechSynthesis.onvoiceschanged = () => {}; }

/* Modal controls */
document.getElementById('btnVistoFechar')?.addEventListener('click', closeModal);
document.getElementById('btnVistoOk')?.addEventListener('click', closeModal);
document.getElementById('modalVisto')?.addEventListener('click', (e)=>{
  if(e.target.id === 'modalVisto') closeModal();
});

/* Initial render */
setLang('pt');
</script>
</body>
</html>
